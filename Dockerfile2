FROM node as build

WORKDIR /app

COPY package*.json ./

ENV NODE_OPTIONS=--openssl-legacy-provider
RUN npm config set registry https://registry.npm.taobao.org && \
    npm install && \
    npm run build:prod

COPY . .

RUN npm run build:prod

FROM nginx:latest
COPY --from=build /app/dist/ /usr/share/nginx/html
